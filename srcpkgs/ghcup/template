# Template file for 'ghcup'
pkgname=ghcup
version=0.1.17.8
revision=1
#archs='x86_64 i686'
wrksrc="ghcup-hs-v$version"
hostmakedepends='tar git cabal-install'
makedepends='zlib-devel ncurses-libtinfo-devel libarchive-devel'
depends='zlib ncurses-libtinfo-libs libarchive gcc gmp make perl'
short_desc='Installer for the general purpose language Haskell'
maintainer='Kye Shi <shi.kye@gmail.com>'
license='LGPL-3.0-only'
homepage='https://www.haskell.org/ghcup/'
distfiles="https://gitlab.haskell.org/haskell/ghcup-hs/-/archive/v$version/ghcup-hs-v$version.tar.gz"
checksum='15156760d8593045515002c8c91803cbf67c9eb4bab357c46d2fdedea8c63ab1'
nopie_files='/usr/bin/ghcup'
nocross='cannot cross compile haskell yet'

do_build() {
	cabal update --prefix="$PWD"
	cabal build --prefix="$PWD" --project-file='cabal.ghc902.project' -f'+internal-downloader' -f'-system-libarchive' -f'+tui'
}

do_install() {
	cabal install --prefix="$PWD" --install-method='copy' --installdir="$DESTDIR/usr/bin"
	for sh in 'bash' 'fish' 'zsh'; do
		vcompletion "scripts/shell-completions/$sh" "$sh"
	done
}
